pr:
- main

pool:
  vmImage: 'ubuntu-latest'

jobs:
- job: 'DetectNewErrors'
  timeoutInMinutes: 360
  steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '16.x'
    displayName: 'Install Node.js'
  - task: npmAuthenticate@0
    inputs:
      workingFile: './.npmrc'
  - task: AzureKeyVault@1
    inputs:
      azureSubscription: 'TypeScript â€“ Internal Services(57bfeeed-c34a-4ffd-a06b-ccff27ac91b8)'
      KeyVaultName: 'jststeam-passwords'
      SecretsFilter: 'TypeScriptErrorDeltas'
      RunAsPreJob: false
  - script: |
      npm ci
      npm run build
      npm test
    env:
      GITHUB_PAT: $(TypeScriptErrorDeltas)
